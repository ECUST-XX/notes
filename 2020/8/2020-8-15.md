### tcp在丢包后会尝试重传,重传次数在 /proc/sys/net/ipv4/tcp_syn_retries 中配置,在archlinux和centos7中为6次,每次尝试重传的时间间隔为上一次的一倍

### 有时由于某一端服务已经结束,四次挥手时响应的ACK包会和FIN包合并从而简化为三次挥手

### 由于http请求依赖tcp协议所以,所以http默认超时时间与tcp重传有关,如果目标服务器都不存在的话会在网络层尝试arp请求后就失败了错误码为7(No route to host),如果服务器存在才是tcp建连失败错误码为28(Connection timed out)

### 一般默认情况下tcp保活机制是在连续2h没有包传输时,每隔75s连续发送9个探测报文,如果9个探测报文都没有响应则认为连接失效,客户端会从ESTABLISHED状态断开连接

### TCP中有Nagle算法和延迟确认两种方式来提高数据传输效率,但是当两种优化同时使用时可能反而会造成效率降低

### Nagle策略默认打开,但在telenet或者ssh等要求及时性的应用中应当设置TCP_NODELAY将其关闭

* 没有已发送未确认报文时,立即发送数据
* 存在未确认报文时,直到 没有已发送未确认报⽂ 或 数据⻓度达到 MSS ⼤⼩ 时,再发送数据
* 只要没满⾜上⾯条件中的⼀条,发送⽅⼀直在囤积数据,直到满⾜上⾯的发送条件

### 延迟确认策略

* 当有响应数据要发送时,ACK会随着响应数据⼀起⽴刻发送给对⽅
* 当没有响应数据要发送时,ACK将会延迟⼀段时间,以等待是否有响应数据可以⼀起发送
* 如果在延迟等待发送ACK期间,对⽅的第⼆个数据报⽂⼜到达了,这时就会⽴刻发送ACK

### TCP为了改善网络拥堵使用了滑动窗口机制,双方通讯时会告知对方可用窗口大小,当一方窗口减少至0时则另一方发送窗口探测包,探测的时间间隔会逐步翻倍

